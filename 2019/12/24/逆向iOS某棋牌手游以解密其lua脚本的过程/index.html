<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>é€†å‘iOSæŸæ£‹ç‰Œæ‰‹æ¸¸ä»¥è§£å¯†å…¶luaè„šæœ¬çš„è¿‡ç¨‹ | Evi1024</title><meta name="description" content="é€†å‘iOSæŸæ£‹ç‰Œæ‰‹æ¸¸ä»¥è§£å¯†å…¶luaè„šæœ¬çš„è¿‡ç¨‹"><meta name="keywords" content="iOS,ç§»åŠ¨å®‰å…¨,é€†å‘"><meta name="author" content="Evi1024"><meta name="copyright" content="Evi1024"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="é€†å‘iOSæŸæ£‹ç‰Œæ‰‹æ¸¸ä»¥è§£å¯†å…¶luaè„šæœ¬çš„è¿‡ç¨‹"><meta name="twitter:description" content="é€†å‘iOSæŸæ£‹ç‰Œæ‰‹æ¸¸ä»¥è§£å¯†å…¶luaè„šæœ¬çš„è¿‡ç¨‹"><meta name="twitter:image" content="https://i.loli.net/2019/05/22/5ce53eb6dc82757840.jpg"><meta property="og:type" content="article"><meta property="og:title" content="é€†å‘iOSæŸæ£‹ç‰Œæ‰‹æ¸¸ä»¥è§£å¯†å…¶luaè„šæœ¬çš„è¿‡ç¨‹"><meta property="og:url" content="https://www.evi1024.com/2019/12/24/%E9%80%86%E5%90%91iOS%E6%9F%90%E6%A3%8B%E7%89%8C%E6%89%8B%E6%B8%B8%E4%BB%A5%E8%A7%A3%E5%AF%86%E5%85%B6lua%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%87%E7%A8%8B/"><meta property="og:site_name" content="Evi1024"><meta property="og:description" content="é€†å‘iOSæŸæ£‹ç‰Œæ‰‹æ¸¸ä»¥è§£å¯†å…¶luaè„šæœ¬çš„è¿‡ç¨‹"><meta property="og:image" content="https://i.loli.net/2019/05/22/5ce53eb6dc82757840.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '1'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://www.evi1024.com/2019/12/24/%E9%80%86%E5%90%91iOS%E6%9F%90%E6%A3%8B%E7%89%8C%E6%89%8B%E6%B8%B8%E4%BB%A5%E8%A7%A3%E5%AF%86%E5%85%B6lua%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%87%E7%A8%8B/"><link rel="next" title="ç¬”è®°ï¼šç¼–è¯‘åŸºäºllvm8.0çš„Xcodeæ··æ·†å™¨toolchain" href="https://www.evi1024.com/2019/12/23/%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%BC%96%E8%AF%91%E5%9F%BA%E4%BA%8Ellvm8-0%E7%9A%84Xcode%E6%B7%B7%E6%B7%86%E5%99%A8toolchain/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://evi1024.com/","msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  highlight_copy: 'false',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime_unit: 'å¤©',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Evi1024</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="https://pic.superbed.cn/item/5dc299d18e0e2e3ee931cdb2.png" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">5</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">5</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">ç›®å½•</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x00-å‰è¨€"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">0x00 å‰è¨€</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x01-ä¸€äº›ç®€å•çš„å°è¯•"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">0x01 ä¸€äº›ç®€å•çš„å°è¯•</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x02-å¦è¾Ÿè¹Šå¾„"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">0x02 å¦è¾Ÿè¹Šå¾„</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x03-lldbçš„å‘"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">0x03 lldbçš„å‘</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#0x04-æŸ³æš—èŠ±æ˜"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text">0x04 æŸ³æš—èŠ±æ˜</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#å‚è€ƒï¼š"><span class="toc_mobile_items-number">5.1.</span> <span class="toc_mobile_items-text">å‚è€ƒï¼š</span></a></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-å‰è¨€"><span class="toc-number">1.</span> <span class="toc-text">0x00 å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-ä¸€äº›ç®€å•çš„å°è¯•"><span class="toc-number">2.</span> <span class="toc-text">0x01 ä¸€äº›ç®€å•çš„å°è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-å¦è¾Ÿè¹Šå¾„"><span class="toc-number">3.</span> <span class="toc-text">0x02 å¦è¾Ÿè¹Šå¾„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-lldbçš„å‘"><span class="toc-number">4.</span> <span class="toc-text">0x03 lldbçš„å‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-æŸ³æš—èŠ±æ˜"><span class="toc-number">5.</span> <span class="toc-text">0x04 æŸ³æš—èŠ±æ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å‚è€ƒï¼š"><span class="toc-number">5.1.</span> <span class="toc-text">å‚è€ƒï¼š</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2019/05/22/5ce53eb6dc82757840.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">é€†å‘iOSæŸæ£‹ç‰Œæ‰‹æ¸¸ä»¥è§£å¯†å…¶luaè„šæœ¬çš„è¿‡ç¨‹</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> å‘è¡¨äº 2019-12-24<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> æ›´æ–°äº 2019-12-24</time><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>é˜…è¯»é‡: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>æ–‡æœ¬å†…å®¹åªä¸ºäº¤æµå­¦ä¹ ä¹‹ç”¨ï¼Œå¦‚æœ‰äººç”¨äºéæ³•ç”¨é€”ï¼Œäº§ç”Ÿçš„åæœç¬”è€…ä¸è´Ÿä»»ä½•è´£ä»»ã€‚ç”±äºæœ¬äººæ°´å¹³æœ‰é™ï¼Œä¸è¶³ä¹‹å¤„è¿˜è¯·å¤§å®¶å¤šå¤šæŒ‡æ­£ã€‚</p>
<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>å‰æ®µæ—¶é—´åœ¨å®¡è®¡ä¸€æ¬¾iOSæ£‹ç‰Œæ‰‹æ¸¸çš„æ—¶å€™ï¼Œå‘ç°äº†å¤§é‡çš„luacåŠ å¯†æ–‡ä»¶ï¼Œæ–‡ä»¶å¤´éƒ¨éƒ½æ˜¯ç»Ÿä¸€çš„Magic numberï¼Œè¿™å¼•èµ·äº†æˆ‘çš„å¥½å¥‡ã€‚äºæ˜¯ï¼Œä¸€ç•ªæœç´¢ï¼Œå‘ç°è¿™æ˜¯ä½¿ç”¨äº†cocos2d-xå¼•æ“å†™çš„æ¸¸æˆï¼Œæ¸¸æˆé€»è¾‘ä½¿ç”¨luaè„šæœ¬ç¼–å†™ï¼Œä¸ºäº†ä¸æš´éœ²luaæºç ï¼ŒæŠŠluaç¼–è¯‘ä¸ºluacå­—èŠ‚ç å¹¶åšäº†åŠ å¯†å¤„ç†ã€‚å…³äºè§£å¯†çš„æ–‡ç« ï¼Œç½‘ä¸Šæœç´¢åˆ°çš„å¤§éƒ¨åˆ†éƒ½æ˜¯Androidç³»ç»Ÿä¸‹çš„ï¼ŒiOSçš„å¾ˆå°‘ï¼Œè™½ç„¶cocos2d-xæ˜¯è·¨å¹³å°çš„ï¼Œä½†æ˜¯åœ¨é€†å‘ç ´è§£çš„è¿‡ç¨‹ä¸­å‘ç°ä¸¤ä¸ªå¹³å°è¿˜ä¼šæœ‰äº›ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œäºæ˜¯æœ‰äº†æœ¬æ–‡ã€‚</p>
<h2 id="0x01-ä¸€äº›ç®€å•çš„å°è¯•"><a href="#0x01-ä¸€äº›ç®€å•çš„å°è¯•" class="headerlink" title="0x01 ä¸€äº›ç®€å•çš„å°è¯•"></a>0x01 ä¸€äº›ç®€å•çš„å°è¯•</h2><p>åœ¨å­¦ä¹ äº†ä¸€äº›è§£å¯†æ€è·¯åï¼Œå¼€å§‹äº†ä¸€äº›ç®€å•çš„å°è¯•ï¼Œé¦–å…ˆè§‚å¯Ÿåˆ°æ‰€æœ‰luacå¤´éƒ¨çš„Magic numberéƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªMagic numberå¾ˆæœ‰å¯èƒ½æ˜¯ä½¿ç”¨xxteaåŠ å¯†ç®—æ³•åŠ å¯†çš„signå€¼ã€‚å¦‚ä¸‹å›¾å…¥çº¢è‰²æ‰“ç éƒ¨åˆ†å°±æ˜¯Magic numberã€‚</p>
<p><img alt="luac" title="luac" data-src="https://pic2.superbed.cn/item/5e01d66d76085c32896c78ab.png" class="lazyload"></p>
<p>xxteaåŠ å¯†ç®—æ³•ä¸€èˆ¬éœ€è¦ä¸€ä¸ªsignå€¼å’Œä¸€ä¸ªkeyæ¥åŠ å¯†ï¼Œé¦–å…ˆå°è¯•ç›´æ¥åœ¨IDAä¸­æœç´¢signå€¼å­—ç¬¦ä¸²ï¼Œsignå€¼é™„è¿‘çš„å­—ç¬¦ä¸²å¾ˆæœ‰å¯èƒ½å°±æ˜¯keyå€¼ã€‚ä½†æœ€ç»ˆæ²¡èƒ½åœ¨IDAé‡Œæ‰¾åˆ°ä¸signåŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œçœ‹æ¥è¿™æ¬¾æ¸¸æˆè¿˜æ˜¯åšäº†ä¸€äº›é˜²æŠ¤çš„ã€‚</p>
<p>æ¥ä¸‹æ¥å°è¯•å®šä½åŠ è½½luaè„šæœ¬å‡½æ•°ï¼Œç„¶åç”¨lldbæ–­ç‚¹è°ƒè¯•ï¼Œæ‰¾å‡ºåŠ å¯†ä½¿ç”¨çš„keyå€¼ã€‚æŒ‰ç…§ç½‘ä¸Šä»‹ç»çš„æ–¹æ³•ï¼Œåœ¨IDAé‡Œç›´æ¥æœç´¢åŠ è½½è§£å¯†åçš„luaè„šæœ¬å‡½æ•°<code>luaL_loadbuffer</code>ï¼ŒiOSä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯æœç´¢ä¸åˆ°çš„ï¼Œå› ä¸ºAndroidçš„luaè§£æå¼•æ“æ˜¯nativeçš„ä»£ç ï¼Œéœ€è¦ç¼–è¯‘ä¸ºsoæ¥è°ƒç”¨ï¼Œè¿™å°±éœ€è¦å¯¼å‡ºç›¸å…³å‡½æ•°ç»™javaè°ƒç”¨ï¼Œè€ŒiOSå¯ä»¥ä½¿ç”¨é™æ€æ··ç¼–ï¼Œclangç¼–è¯‘å™¨åœ¨ç¼–è¯‘c/c++ä»£ç çš„æ—¶å€™ä¸€èˆ¬éƒ½ä¼šæŠŠå‡½æ•°ç¬¦å·ç»™stripæ‰ï¼Œå› æ­¤iOSä¸åƒAndroidé‚£æ ·å¯ä»¥ç›´æ¥æœç´¢å…³é”®å‡½æ•°ã€‚ä½†æ˜¯è¿™é‡Œå´ç¥å¥‡çš„æ‰¾åˆ°äº†ï¼Œå¯èƒ½æ˜¯å¼€å‘è€…ä¸å°å¿ƒå¿˜äº†stripäº†ï¼Ÿ</p>
<p><img alt="luaL_loadbufferå‡½æ•°" title="luaL_loadbuffer" data-src="https://pic3.superbed.cn/item/5e01dacc76085c32896e7c84.png" class="lazyload"></p>
<p>æ¬£å–œä¹‹ä¸‹èµ¶ç´§åœ¨Xcodeé‡Œæ‰“äº†ç¬¦å·æ–­ç‚¹ï¼Œç„¶è€Œè¿˜æ˜¯é«˜å…´çš„å¤ªæ—©äº†ï¼Œæ–­ç‚¹æ ¹æœ¬å°±æ²¡æœ‰è§¦å‘ã€‚éš¾é“æ²¡æœ‰è°ƒç”¨è¿™ä¸ªå‡½æ•°å»åŠ è½½luaè„šæœ¬ï¼Ÿåˆå°è¯•äº†<code>luaL_loadbufferx</code>å‡½æ•°å’Œä¸€äº›ç›¸å…³çš„å¯¼å‡ºå‡½æ•°ï¼Œç„¶è€Œéƒ½æ²¡æœ‰æ–­ä¸‹æ¥ã€‚What?!è¿™é‡Œè¯·è„‘è¡¥é»‘äººé—®å·çš„è¡¨æƒ…ã€‚ã€‚ã€‚</p>
<p><img alt="å°è¯•è¿‡çš„ç¬¦å·æ–­ç‚¹" data-src="https://pic2.superbed.cn/item/5e01dc2776085c32896f2e6e.png" class="lazyload"></p>
<p>é€šè¿‡å‡½æ•°ç¬¦å·æ—¢ç„¶æ–­ä¸ä¸‹æ¥ï¼Œé‚£å°±æ¥ç€å°è¯•å®šä½æ²¡æœ‰ç¬¦å·çš„å‡½æ•°ï¼Œç„¶åé€šè¿‡å‡½æ•°åœ°å€ä¸‹æ–­ç‚¹ã€‚é€šè¿‡æœç´¢å…³é”®å‡½æ•°é‡Œçš„å­—ç¬¦ä¸²ç‰¹å¾<code>â€error loading module &#39;%s&#39; from file&quot;</code>å®šä½<code>luaL_loadbuffer</code>å‡½æ•°ã€‚è¿™é‡Œå®šä½åˆ°ä¸‰ä¸ªå‡½æ•°é‡Œå‡ºç°äº†å…³é”®å­—ç¬¦ä¸²ã€‚</p>
<p><img alt="é€šè¿‡å­—ç¬¦ä¸²å®šä½" data-src="https://pic.superbed.cn/item/5e01e0a676085c3289712f55.png" class="lazyload"></p>
<p>é€šè¿‡å‡½æ•°çš„æ–‡ä»¶åœ°å€+ASLRåç§»åˆ†åˆ«å¯¹è¿™ä¸‰ä¸ªå‡½æ•°ä¸‹åœ°å€æ–­ç‚¹ï¼Œç„¶è€Œå‡½æ•°è¿˜æ˜¯æ²¡æœ‰æ–­ä¸‹æ¥ã€‚</p>
<p>è¿™æ—¶æˆ‘ä»¿ä½›è§‰å¾—äº‹æƒ…å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œè¿™äº›æš´éœ²å‡ºæ¥çš„å®šä½å‡½æ•°çš„å…³é”®ç‚¹å¯èƒ½åªæ˜¯ä¸ºäº†è¿·æƒ‘é€†å‘äººå‘˜è€Œæ”¾çš„çš„çƒŸé›¾å¼¹ã€‚</p>
<h2 id="0x02-å¦è¾Ÿè¹Šå¾„"><a href="#0x02-å¦è¾Ÿè¹Šå¾„" class="headerlink" title="0x02 å¦è¾Ÿè¹Šå¾„"></a>0x02 å¦è¾Ÿè¹Šå¾„</h2><p>æ—¢ç„¶ä½ æŠŠå‡½æ•°ç¬¦å·stripäº†ï¼Œå­—ç¬¦ä¸²ä¹Ÿéƒ½åšäº†å¤„ç†ï¼Œè¿˜æ”¾äº†çƒŸé›¾å¼¹ã€‚é‚£æˆ‘å°±å¦è¾Ÿè¹Šå¾„ï¼Œé€šè¿‡ä¸€äº›å¿…é¡»è°ƒç”¨çš„ç³»ç»Ÿåº“å‡½æ•°ä½œä¸ºå…¥å£ç‚¹ã€‚æ—¢ç„¶ä½ è¦å¤„ç†æ–‡ä»¶ï¼Œé‚£è‚¯å®šè¦è°ƒç”¨åº“å‡½æ•°fopenå§ï¼Œä½†æ˜¯fopenè°ƒç”¨çš„å¤ªé¢‘ç¹ï¼Œæ€ä¹ˆå®šä½åˆ°æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç‚¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ˜¯ä½¿ç”¨Xcodeçš„debugger commandï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨fish hookï¼ŒæŠŠfopençš„å‚æ•°æ‰“å°å‡ºæ¥ï¼Œè°ƒç”¨æ ˆä¹Ÿæ‰“å°å‡ºæ¥ï¼Œå‘ç°ä»¥<code>.luac</code>ç»“å°¾çš„æ–‡ä»¶ï¼Œå°±æ˜¯ä½ æ„Ÿå…´è¶£çš„ç‚¹ã€‚</p>
<p><img alt="debugger command" data-src="https://pic1.superbed.cn/item/5e01e75276085c328974280c.png" class="lazyload"></p>
<p>æŒ‰ç…§è¿™ä¸ªæ–¹æ³•ä¸€æ­¥æ­¥è·Ÿåˆ°è§£æå‡ºæ–‡ä»¶å¤´éƒ¨signå€¼çš„å‡½æ•°ï¼Œä½†è·Ÿåˆ°è¿™é‡Œè°ƒç”¨æ ˆå°±è«åçš„æ²¡æœ‰äº†ï¼ŒIDAé‡Œxrefè¿™ä¸ªå‡½æ•°çš„æ—¶å€™å‘ç°æ˜¯ä¸€ä¸ªåœ¨å¸¸é‡åŒºçš„vtableè™šå‡½æ•°è¡¨ï¼Œè¿™ä¸‹é™æ€åˆ†æä¹Ÿæ–­äº†ã€‚</p>
<p><img alt="vtable" data-src="https://pic3.superbed.cn/item/5e01eb8476085c32897676c0.png" class="lazyload"></p>
<p>æŸ¥çœ‹è¿™ä¸ªvtableå‘ç°äº†å…³é”®ç‚¹<code>cocos2d::LuaStack</code>ï¼Œäºæ˜¯åˆ°cocos2då¼€æºçš„githubåº“å»æœç´¢äº†ä¸€ç•ªï¼Œæœ€ç»ˆå®šä½åˆ°<code>CCLuaStack.cpp</code>è¿™ä¸ªæºç æ–‡ä»¶ï¼Œç„¶åé€šè¿‡å¯¹æ¯”æºç å’ŒIDAé‡Œvtableçš„ç›¸é‚»å‡½æ•°ï¼Œæœ€ç»ˆå®šä½åˆ°äº†æˆ‘ä»¬æ„Ÿå…´è¶£çš„å‡½æ•°<code>luaLoadBuffer</code>çš„åœ°å€ã€‚äºæ˜¯ï¼Œè¿…é€Ÿçš„è®¡ç®—ASLRåç§»åœ°å€ï¼Œä¸‹æ–­ç‚¹ï¼Œç„¶åæƒŠå–œçš„å‘ç°ï¼Œlldbçš„åæ±‡ç¼–è·ŸIDAé‡Œçš„å±…ç„¶å¯¹ä¸ä¸Šï¼What?! è¯·å†æ¬¡è„‘è¡¥é»‘äººé—®å·è¡¨æƒ…ã€‚ã€‚ã€‚</p>
<h2 id="0x03-lldbçš„å‘"><a href="#0x03-lldbçš„å‘" class="headerlink" title="0x03 lldbçš„å‘"></a>0x03 lldbçš„å‘</h2><p>ç»è¿‡ä¸€ç•ªæœç´¢ï¼Œæœ‰äººè¯´æ˜¯é«˜ç‰ˆæœ¬lldbçš„é—®é¢˜ï¼Œä¹Ÿæœ‰äººè¯´æ˜¯32ä½iOSè®¾å¤‡ä¸Šå¯èƒ½åæ±‡ç¼–å‡ºæ¥çš„æ˜¯armæŒ‡ä»¤é›†ï¼Œä¸IDAé‡Œçš„thumbæŒ‡ä»¤ä¸ä¸€è‡´ã€‚</p>
<p>å…ˆå°è¯•æŠŠarmæŒ‡ä»¤åæ±‡ç¼–ä¸ºthumbæŒ‡ä»¤ï¼Œä½¿ç”¨å‘½ä»¤<code>di --start-address 0x00AABBCC -c 10 -A thumbv7</code>è½¬æ¢ï¼Œç„¶è€Œå‘ç°è¿˜æ˜¯ä¸€æ ·ä¸ä¸€è‡´ã€‚</p>
<p>äºæ˜¯åˆå°è¯•ä¸‹è½½äº†Xcode7.2ï¼Œä½¿ç”¨ä½ç‰ˆæœ¬çš„Xcodeçš„lldbå»è°ƒè¯•ï¼Œç”±äºä½ç‰ˆæœ¬çš„Xcodeå¯¹é«˜ç‰ˆæœ¬çš„iOSç³»ç»Ÿä¸å…¼å®¹ï¼ŒæœŸé—´åˆè§£å†³äº†ä¸€äº›å…¼å®¹æ€§çš„é—®é¢˜ã€‚æœ€ç»ˆè°ƒè¯•åå‘ç°ï¼Œé—®é¢˜ä¾æ—§ï¼Œè¿˜æ˜¯ä¸å¯¹ä¸Šå•ŠğŸ˜¢ã€‚åœ¨å„ç§å¯¹æ¯”å„ç§æ±‚é—®æœç´¢åæœ€ç»ˆè®¤ä¸ºåº”è¯¥æ˜¯è®¡ç®—ASLRçš„åŸºåœ°å€å‡ºäº†é—®é¢˜ã€‚</p>
<p>æˆ‘ä¸€èˆ¬æ˜¯ä½¿ç”¨<code>image list</code>è¿™ä¸ªlldbå‘½ä»¤ç¡®å®šåŸºåœ°å€çš„ï¼Œä½†æ˜¯ç½‘ä¸Šæœç´¢åˆ°ä¸€ç¯‡å¸–å­è¯´<code>image list -o -f</code>ç¡®å®šçš„åŸºåœ°å€ä¼šå‡ºç°é—®é¢˜ï¼Œè€Œ<code>image list</code>å´æ˜¯å¥½çš„ï¼Œè€Œä¸”ä¸¤è€…çš„åŸºåœ°å€å±…ç„¶ä¸ä¸€æ ·ã€‚äºæ˜¯æˆ‘å°è¯•ä½¿ç”¨<code>image list -o -f</code>è¿™ä¸ªå‘½ä»¤å‘ç°ç¡®å®å’Œ<code>image list</code>çš„åŸºåœ°å€ä¸ä¸€æ ·ï¼Œç„¶åå°è¯•ä½¿ç”¨<code>image list -o -f</code>çš„åŸºåœ°å€è®¡ç®—å‡ºASLRåçš„åœ°å€ï¼Œä¸‹æ–­ç‚¹ï¼Œæœ€åæƒŠå¥‡çš„å‘ç°ï¼Œå±…ç„¶èƒ½å¯¹ä¸Šäº†ï¼What?!</p>
<p>è¿™é‡Œä½¿ç”¨<code>image list -o -f</code>ç¡®å®šçš„åŸºåœ°å€è™½ç„¶æ­£ç¡®äº†ï¼Œä½†æ˜¯å…¶ä»–æ¨¡å—çš„åœ°å€å´æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„å§ï¼Œæœ‰å›¾æœ‰çœŸç›¸</p>
<p><img alt="å…¶ä»–æ¨¡å—åŸºåœ°å€ä¸€æ ·" data-src="https://pic3.superbed.cn/item/5e01faee76085c328980b0dd.png" class="lazyload"></p>
<p><code>image list -o -f</code>å’Œ<code>image list</code>éƒ½æœ‰é—®é¢˜ï¼Œé‚£å¤šäº†<code>-o -f</code>å‚æ•°åä¸¤è€…æœ‰ä»€ä¹ˆå´åˆ«å‘¢ï¼Ÿ <img alt="image listå‚æ•°" data-src="https://pic1.superbed.cn/item/5e01fb5376085c328980fa9b.png" class="lazyload"></p>
<p>çœ‹æ ·å­<code>-o</code>å‚æ•°è¿˜æ˜¯è¦åŠ çš„ï¼Œä½†æ˜¯åŠ äº†å…¶ä»–æ¨¡å—çš„åœ°å€å´éƒ½æ˜¯ä¸€æ ·çš„æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿlldbçš„bugï¼Ÿ</p>
<h2 id="0x04-æŸ³æš—èŠ±æ˜"><a href="#0x04-æŸ³æš—èŠ±æ˜" class="headerlink" title="0x04 æŸ³æš—èŠ±æ˜"></a>0x04 æŸ³æš—èŠ±æ˜</h2><p>ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œlldbæ–­ç‚¹ç»ˆäºèƒ½æ–­åœ¨æ­£ç¡®çš„ä½ç½®ä¸Šäº†ï¼Œç»è¿‡è°ƒè¯•å‰é¢å‘ç°çš„<code>luaLoadBuffer</code>å‡½æ•°ï¼Œæœ€ç»ˆå‘ç°äº†xxteaè§£å¯†çš„å…³é”®å¯†é’¥keyã€‚ç°åœ¨æœ‰äº†signå’Œkeyï¼Œé‚£è§£å¯†å°±å¾ˆå¥½è¯´äº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šè§£å¯†å·¥å…·å¯ä»¥ä½¿ç”¨ï¼Œæ‰“å¼€è§£å¯†å·¥å…·ï¼Œå¡«ä¸Škeyå’Œsignï¼ŒæˆåŠŸè§£å¯†å‡ºluaè„šæœ¬ã€‚</p>
<p><img alt="è§£å¯†åçš„luaè„šæœ¬" data-src="https://pic2.superbed.cn/item/5e01fddd76085c328982aaf0.png" class="lazyload"></p>
<h3 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h3><p><a href="https://bbs.pediy.com/thread-216969.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-216969.htm</a></p>
<p><a href="https://www.freebuf.com/column/173230.html" target="_blank" rel="noopener">https://www.freebuf.com/column/173230.html</a></p>
<p><a href="https://blog.csdn.net/lwanttowin/article/details/80628835" target="_blank" rel="noopener">https://blog.csdn.net/lwanttowin/article/details/80628835</a></p>
<p><a href="https://zhuanlan.kanxue.com/article-8282.htm" target="_blank" rel="noopener">https://zhuanlan.kanxue.com/article-8282.htm</a></p>
<p><a href="http://bbs.iosre.com/t/lldb-image-list/7593/6" target="_blank" rel="noopener">http://bbs.iosre.com/t/lldb-image-list/7593/6</a></p>
<p>EOF</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">Evi1024</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://www.evi1024.com/2019/12/24/%E9%80%86%E5%90%91iOS%E6%9F%90%E6%A3%8B%E7%89%8C%E6%89%8B%E6%B8%B8%E4%BB%A5%E8%A7%A3%E5%AF%86%E5%85%B6lua%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%87%E7%A8%8B/">https://www.evi1024.com/2019/12/24/%E9%80%86%E5%90%91iOS%E6%9F%90%E6%A3%8B%E7%89%8C%E6%89%8B%E6%B8%B8%E4%BB%A5%E8%A7%A3%E5%AF%86%E5%85%B6lua%E8%84%9A%E6%9C%AC%E7%9A%84%E8%BF%87%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://www.evi1024.com">Evi1024</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/iOS/">iOS    </a><a class="post-meta__tags" href="/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/">ç§»åŠ¨å®‰å…¨    </a><a class="post-meta__tags" href="/tags/%E9%80%86%E5%90%91/">é€†å‘    </a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2019/05/22/5ce53eb6dc82757840.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2019/12/23/%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%BC%96%E8%AF%91%E5%9F%BA%E4%BA%8Ellvm8-0%E7%9A%84Xcode%E6%B7%B7%E6%B7%86%E5%99%A8toolchain/"><img class="next_cover lazyload" data-src="https://i.loli.net/2019/05/22/5ce53eb6dc82757840.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info"><span>ç¬”è®°ï¼šç¼–è¯‘åŸºäºllvm8.0çš„Xcodeæ··æ·†å™¨toolchain</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/11/07/CVE-2019-8647-iMessageè¿œç¨‹æ— äº¤äº’è§¦å‘iOSæ¼æ´å¤ç°/" title="CVE-2019-8647 iMessageè¿œç¨‹æ— äº¤äº’è§¦å‘iOSæ¼æ´å¤ç°"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2019/05/22/5ce53eb6dc82757840.jpg"><div class="relatedPosts_title">CVE-2019-8647 iMessageè¿œç¨‹æ— äº¤äº’è§¦å‘iOSæ¼æ´å¤ç°</div></a></div><div class="relatedPosts_item"><a href="/2019/12/06/iOS-macOS-Appæ³¨å…¥æ¯’æ¶²æœ¨é©¬ç¨‹åº/" title="iOS/macOS Appæ³¨å…¥æ¯’æ¶²æœ¨é©¬ç¨‹åº"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2019/05/22/5ce53eb6dc82757840.jpg"><div class="relatedPosts_title">iOS/macOS Appæ³¨å…¥æ¯’æ¶²æœ¨é©¬ç¨‹åº</div></a></div><div class="relatedPosts_item"><a href="/2019/12/23/ç¬”è®°ï¼šç¼–è¯‘åŸºäºllvm8-0çš„Xcodeæ··æ·†å™¨toolchain/" title="ç¬”è®°ï¼šç¼–è¯‘åŸºäºllvm8.0çš„Xcodeæ··æ·†å™¨toolchain"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2019/05/22/5ce53eb6dc82757840.jpg"><div class="relatedPosts_title">ç¬”è®°ï¼šç¼–è¯‘åŸºäºllvm8.0çš„Xcodeæ··æ·†å™¨toolchain</div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> è¯„è®º</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '1842ba6d60680257250f',
  clientSecret: 'f0828970d8ad37b32f85b91316e8eb5e8f7d9600',
  repo: 'evi1024.github.io',
  owner: 'evi1024',
  admin: 'evi1024',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div></div><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 By Evi1024</div><div class="framework-info"><span>é©±åŠ¨ </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="é˜…è¯»æ¨¡å¼"></i><i class="fa fa-plus" id="font_plus" title="æ”¾å¤§å­—ä½“"></i><i class="fa fa-minus" id="font_minus" title="ç¼©å°å­—ä½“"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="ç®€ç¹è½¬æ¢" target="_self">ç¹</a><i class="darkmode fa fa-moon-o" id="darkmode" title="å¤œé—´æ¨¡å¼"></i></div><div id="rightside-config-show"><div id="rightside_config" title="è®¾ç½®"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="ç›®å½•" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="å›åˆ°é¡¶éƒ¨" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>